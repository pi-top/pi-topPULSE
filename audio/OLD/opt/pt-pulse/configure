#!/bin/bash

set_audio_output_to_analog() {
	INTERFACE="$(amixer cget numid=3 | grep ": values=" | cut -d'=' -f2)"
	# If the interface is not analog
	if [[ $INTERFACE != "1" ]]; then
		# Set interface to analog
		amixer cset numid=3 1 &> /dev/null
		# Reload interface
		sudo /etc/init.d/alsa-utils restart &> /dev/null
	fi
}

if [ "$#" -ne 1 ]; then
	echo "1 parameter accepted only"
	exit 1
fi

arg="$1"

if [[ "$arg" != "on" ]] && [[ "$arg" != "off" ]]; then
	echo "Invalid parameter: 'on' and 'off' only"
	exit 1
fi

if [[ "$arg" == "on" ]]; then
	gpio -g mode 13 pwm
	set_audio_output_to_analog
else
	gpio -g mode 13 in
fi